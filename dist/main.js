(()=>{"use strict";let e=[];class t{constructor(e,t){this.title=e,this.tasks=t}removeProject(){e.splice(e.indexOf(this),1)}addTask(e){this.tasks.push(e)}removeTask(e){this.tasks.splice(this.tasks.indexOf(e),1)}}class n{constructor(e,t,n,s,d){this.title=e,this.desc=t,this.duedate=n,this.priority=s,this.complete=d}}function s(){localStorage.setItem("projects",JSON.stringify(e))}!function(){if(localStorage.length>0){const n=JSON.parse(localStorage.getItem("projects"));for(let s of n){const n=new t(s.title,s.tasks);e.push(n),r(n)}const s=e[0];if(void 0!==s){document.getElementById("project-header").innerText=s.title,document.getElementById("task-form").dataset.projectIndex=0;for(let e of s.tasks)p(0,s.tasks.indexOf(e))}}}();let d=!1,a=document.getElementById("project-header");const c=document.getElementById("task-form"),o=document.getElementById("project-modal"),l=document.getElementById("task-modal");function i(n){k();const d=document.createElement("div"),c=document.createElement("p"),l=document.createElement("span");for(a.innerText=n,d.classList.add("project"),d.setAttribute("data-project-index",e.length),c.classList.add("mouse-effect"),c.innerText=n,l.classList.add("icon","delete-icon"),document.getElementById("add-project-btn").disabled=!1,c.addEventListener("click",(()=>{a.innerText=n;let t=d.dataset.projectIndex;document.getElementById("task-form").dataset.projectIndex=t,k();for(let n of i.tasks)p(t,e[t].tasks.indexOf(n))})),l.addEventListener("click",(()=>{let t=d.dataset.projectIndex;if(m(d,i),t>0)for(let n of e[t-1].tasks)p(n.title,n.desc,n.duedate,n.priority,n.complete);s()}));d.hasChildNodes();)d.removeChild(d.lastChild);document.getElementById("task-container").appendChild(a),document.getElementById("projects-container").appendChild(d),d.append(c,l),document.getElementById("task-form").dataset.projectIndex=d.dataset.projectIndex,document.getElementById("project-form").reset(),o.style.display="none";const i=function(n,[]){const s=new t(n,[]);return e.push(s),s}(c.innerText,[]);s()}function r(t){const n=document.createElement("div"),d=document.createElement("p"),c=document.createElement("span");for(n.classList.add("project"),n.setAttribute("data-project-index",e.indexOf(t)),d.classList.add("mouse-effect"),d.innerText=t.title,c.classList.add("icon","delete-icon"),d.addEventListener("click",(()=>{a.innerText=t.title;let n=e.indexOf(t);document.getElementById("task-form").dataset.projectIndex=n,k();for(let s of t.tasks)p(n,e[n].tasks.indexOf(s))})),c.addEventListener("click",(()=>{let d=e.indexOf(t);if(m(n,t),d>0)for(let n of e[d-1].tasks)p(n.title,n.desc,n.duedate,n.priority,n.complete,t.title);s()}));n.hasChildNodes();)n.removeChild(n.lastChild);document.getElementById("projects-container").appendChild(n),n.append(d,c)}function m(t,n){let d=t.dataset.projectIndex;t.remove(),n.removeProject(),d>0?(document.getElementById("task-form").dataset.projectIndex=d-1,a.innerText=e[d-1].title):a.innerText="";const c=document.querySelectorAll(`div.task[data-project-index="${d}"]`);for(let e of c)e.remove();const o=document.querySelectorAll(".project");for(let t in e)o[t].setAttribute("data-project-index",t);s()}function u(e){switch(e){case 1:return"red";case 2:return"orange";case 3:return"green";case 4:return"blue"}}function p(t,n){const a=document.createElement("div"),o=document.createElement("span"),i=document.createElement("label"),r=document.createElement("input"),m=document.createElement("p"),p=document.createElement("p"),k=document.createElement("p"),y=document.createElement("p"),L=document.createElement("span"),f=document.createElement("span");let v=e[t].tasks[n];a.classList.add("task"),a.setAttribute("data-project-index",t),a.setAttribute("data-task-index",n),r.type="checkbox",r.classList.add("checkbox"),!0===v.complete?(i.innerText="Complete",r.checked=!0):i.innerText="Unfinished",i.classList.add("checkbox"),o.classList.add("expand"),r.type="checkbox",r.classList.add("checkbox"),!0===v.complete?(i.innerText="Complete",a.classList.add("complete")):(i.innerText="Unfinished",a.classList.remove("complete")),m.innerText=v.title,p.classList.add("desc"),p.innerText=v.desc,k.innerText=v.duedate;let g=u(Number(v.priority));y.style.color=g,y.innerText=v.priority,L.classList.add("icon","edit-icon"),f.classList.add("icon","delete-icon"),o.addEventListener("click",(()=>{o.classList.contains("rotate-up")?(o.classList.remove("rotate-up"),o.classList.add("rotate-down"),a.classList.add("task-expand"),a.classList.remove("task-reduce"),p.classList.add("desc-expand")):o.classList.contains("rotate-down")?(o.classList.remove("rotate-down"),o.classList.add("rotate-up"),a.classList.remove("task-expand"),a.classList.add("task-reduce"),p.classList.remove("desc-expand")):(o.classList.add("rotate-down"),a.classList.add("task-expand"),p.classList.add("desc-expand"))})),r.addEventListener("click",(()=>{!1===v.complete?(v.complete=!0,i.innerText="Complete",a.classList.add("complete")):(v.complete=!1,i.innerText="Unfinished",a.classList.remove("complete")),s()})),L.addEventListener("click",(()=>{d=!0,l.style.display="block",c.dataset.taskIndex=n,x(m.innerText,p.innerText,k.innerText,y.innerText)})),f.addEventListener("click",(()=>{E(a,v)})),document.getElementById("task-container").appendChild(a),a.append(o,r,i,m,p,k,y,L,f)}function k(){const e=document.getElementById("task-container");for(;e.hasChildNodes()&&e.childElementCount>1;)e.removeChild(e.lastChild)}function x(e,t,n,s){document.getElementById("task-title").value=e,document.getElementById("task-desc").value=t,document.getElementById("task-due-date").value=n,document.getElementById("task-priority").value=s}function E(t,n){let d=t.dataset.projectIndex;t.remove(),e[d].removeTask(n);const a=document.querySelectorAll(".task");for(let t in e[d].tasks)a[t].dataset.taskIndex=t;s()}setTimeout((()=>{0===localStorage.length&&i("Default")}),200);const y=document.getElementById("add-project-btn"),L=document.getElementById("add-task-btn"),f=document.getElementById("project-form"),v=document.getElementById("task-form"),g=document.getElementById("project-modal"),h=document.getElementById("task-modal"),I=document.querySelectorAll(".close-btn");window.addEventListener("click",(e=>{e.target==g?(g.style.display="none",f.reset()):e.target==h&&(h.style.display="none",v.reset())})),I[0].addEventListener("click",(()=>{g.style.display="none",f.reset()})),I[1].addEventListener("click",(()=>{h.style.display="none",v.reset()})),f.addEventListener("submit",(e=>{e.preventDefault(),i(e.target[0].value)})),y.addEventListener("click",(()=>{g.style.display="block",document.getElementById("project-name").focus()})),v.addEventListener("submit",(t=>{t.preventDefault(),!1===d?function(t){const a=document.createElement("div"),o=document.createElement("span"),i=document.createElement("label"),r=document.createElement("input"),m=document.createElement("p"),p=document.createElement("p"),k=document.createElement("p"),y=document.createElement("p"),L=document.createElement("span"),f=document.createElement("span");let v=e[t].tasks.length,g=document.getElementById("task-title").value,h=document.getElementById("task-desc").value,I=document.getElementById("task-due-date").value,T=document.getElementById("task-priority").value;a.classList.add("task"),a.setAttribute("data-project-index",t),a.setAttribute("data-task-index",v),o.classList.add("expand"),i.innerText="Unfinished",i.classList.add("checkbox"),r.type="checkbox",r.classList.add("checkbox"),m.innerText=g,p.classList.add("desc"),p.innerText=h,k.innerText=I,y.innerText=T;let j=u(Number(T));y.style.color=j,L.classList.add("icon","edit-icon"),f.classList.add("icon","delete-icon"),o.addEventListener("click",(()=>{o.classList.contains("rotate-up")?(o.classList.remove("rotate-up"),o.classList.add("rotate-down"),a.classList.add("task-expand"),a.classList.remove("task-reduce"),p.classList.add("desc-expand")):o.classList.contains("rotate-down")?(o.classList.remove("rotate-down"),o.classList.add("rotate-up"),a.classList.remove("task-expand"),a.classList.add("task-reduce"),p.classList.remove("desc-expand")):(o.classList.add("rotate-down"),a.classList.add("task-expand"),p.classList.add("desc-expand"))})),r.addEventListener("click",(()=>{!1===B.complete?(B.complete=!0,i.innerText="Complete",a.classList.add("complete")):(B.complete=!1,i.innerText="Unfinished",a.classList.remove("complete")),s()})),L.addEventListener("click",(()=>{d=!0,l.style.display="block",c.dataset.taskIndex=e[t].tasks.indexOf(B),x(m.innerText,p.innerText,k.innerText,y.innerText)})),f.addEventListener("click",(()=>{E(a,B)})),document.getElementById("task-container").appendChild(a),a.append(o,r,i,m,p,k,y,L,f),document.getElementById("task-form").reset(),l.style.display="none";const B=function(t,s,d,a,c,o){const l=new n(t,s,d,a,!1);return e[o].addTask(l),l}(g,h,I,T,0,t);s()}(t.target.dataset.projectIndex):!0===d&&function(t,n,...a){const o=document.querySelector(`div.task[data-task-index="${n}"]`),i=e[t].tasks[n],r=o.childNodes;let m=u(Number(a[3]));r[6].style.color=m,r[3].innerText=a[0],r[4].innerText=a[1],r[5].innerText=a[2],r[6].innerText=a[3],i.title=a[0],i.desc=a[1],i.duedate=a[2],i.priority=a[3],c.reset(),l.style.display="none",d=!1,s()}(t.target.dataset.projectIndex,t.target.dataset.taskIndex,t.target[0].value,t.target[1].value,t.target[2].value,t.target[3].value)})),L.addEventListener("click",(()=>{document.querySelectorAll(".project").length>0&&(h.style.display="block",document.getElementById("task-title").focus())}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUc3RSxVQUFZMkUsRUFBVyxHQUMvQkUsRUFBSyxHQUFHN0UsVUFBWTJFLEVBQVcsR0FDL0JuRyxFQUFLUCxNQUFRMEcsRUFBVyxHQUN4Qm5HLEVBQUtJLEtBQU8rRixFQUFXLEdBQ3ZCbkcsRUFBS0ssUUFBVThGLEVBQVcsR0FDMUJuRyxFQUFLTSxTQUFXNkYsRUFBVyxHQUMzQnBFLEVBQVNxQixRQUNUbkIsRUFBVW9CLE1BQU1DLFFBQVUsT0FDMUJ6QixHQUFPLEVBQ1ByQixHQUNGLENDdlRJK0YsQ0FBU2QsRUFBRUMsT0FBT2pFLFFBQVFDLGFBQWMrRCxFQUFFQyxPQUFPakUsUUFBUXVDLFVBQVd5QixFQUFFQyxPQUFPLEdBQUdSLE1BQU9PLEVBQUVDLE9BQU8sR0FBR1IsTUFDakdPLEVBQUVDLE9BQU8sR0FBR1IsTUFBT08sRUFBRUMsT0FBTyxHQUFHUixNQUNuQyxJQUdGRyxFQUFXeEMsaUJBQWlCLFNBQVMsS0FDbEJ2QixTQUFTcUMsaUJBQWlCLFlBQy9COUMsT0FBUyxJQUNuQixFQUFVd0MsTUFBTUMsUUFBVSxRQUMxQmhDLFNBQVNDLGVBQWUsY0FBY3FFLFFBQ3hDLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvbG9naWMuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL0RPTS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXBwZW5kUHJvamVjdCwgYXBwZW5kVGFzayB9IGZyb20gXCIuL0RPTVwiO1xuXG5sZXQgYXJyUHJvamVjdHMgPSBbXTtcblxuY2xhc3MgUHJvamVjdCB7XG4gIGNvbnN0cnVjdG9yKHRpdGxlLCB0YXNrcykge1xuICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICB0aGlzLnRhc2tzID0gdGFza3M7XG4gIH1cbiAgcmVtb3ZlUHJvamVjdCgpIHtcbiAgICBhcnJQcm9qZWN0cy5zcGxpY2UoYXJyUHJvamVjdHMuaW5kZXhPZih0aGlzKSwgMSk7XG4gIH1cbiAgXG4gIGFkZFRhc2sodGFzaykge1xuICAgIHRoaXMudGFza3MucHVzaCh0YXNrKTtcbiAgfVxuXG4gIHJlbW92ZVRhc2sodGFzaykge1xuICAgIHRoaXMudGFza3Muc3BsaWNlKHRoaXMudGFza3MuaW5kZXhPZih0YXNrKSwgMSk7XG4gIH1cbn1cblxuY2xhc3MgVGFzayB7XG4gIGNvbnN0cnVjdG9yKHRpdGxlLCBkZXNjLCBkdWVkYXRlLCBwcmlvcml0eSwgY29tcGxldGUpIHtcbiAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgdGhpcy5kZXNjID0gZGVzYztcbiAgICB0aGlzLmR1ZWRhdGUgPSBkdWVkYXRlO1xuICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICB0aGlzLmNvbXBsZXRlID0gY29tcGxldGU7XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlUHJvamVjdENsYXNzKHRpdGxlLCBbXSkge1xuICBjb25zdCBwcm9qZWN0ID0gbmV3IFByb2plY3QodGl0bGUsIFtdKTtcbiAgYXJyUHJvamVjdHMucHVzaChwcm9qZWN0KTtcbiAgcmV0dXJuIHByb2plY3Q7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVRhc2tDbGFzcyh0aXRsZSwgZGVzYywgZHVlZGF0ZSwgcHJpb3JpdHksIGNvbXBsZXRlLCBwcm9qZWN0SW5kZXgpIHtcbiAgY29uc3QgdGFzayA9IG5ldyBUYXNrKHRpdGxlLCBkZXNjLCBkdWVkYXRlLCBwcmlvcml0eSwgY29tcGxldGUpO1xuICBhcnJQcm9qZWN0c1twcm9qZWN0SW5kZXhdLmFkZFRhc2sodGFzayk7XG4gIHJldHVybiB0YXNrO1xufVxuXG5mdW5jdGlvbiBnZXRMb2NhbFN0b3JhZ2UoKSB7XG4gIGlmKGxvY2FsU3RvcmFnZS5sZW5ndGggPiAwKSB7XG4gICAgY29uc3Qgc3RvcmFnZVZhbHVlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncHJvamVjdHMnKSk7XG4gICAgZm9yKGxldCBvYmogb2Ygc3RvcmFnZVZhbHVlKSB7XG4gICAgICBjb25zdCBwcm9qZWN0ID0gbmV3IFByb2plY3Qob2JqLnRpdGxlLCBvYmoudGFza3MpO1xuICAgICAgYXJyUHJvamVjdHMucHVzaChwcm9qZWN0KTtcbiAgICAgIGFwcGVuZFByb2plY3QocHJvamVjdCk7XG4gICAgfTtcbiAgICBjb25zdCBmaXJzdFByb2plY3QgPSBhcnJQcm9qZWN0c1swXTtcbiAgICBpZihmaXJzdFByb2plY3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtaGVhZGVyJykuaW5uZXJUZXh0ID0gZmlyc3RQcm9qZWN0LnRpdGxlO1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stZm9ybScpLmRhdGFzZXQucHJvamVjdEluZGV4ID0gMDtcbiAgICAgIGZvcihsZXQgdGFzayBvZiBmaXJzdFByb2plY3QudGFza3MpIHtcbiAgICAgICAgYXBwZW5kVGFzaygwLCBmaXJzdFByb2plY3QudGFza3MuaW5kZXhPZih0YXNrKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHNldExvY2FsU3RvcmFnZSgpIHtcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Byb2plY3RzJywgSlNPTi5zdHJpbmdpZnkoYXJyUHJvamVjdHMpKTtcbn1cblxuZ2V0TG9jYWxTdG9yYWdlKCk7XG5cbmV4cG9ydCB7Y3JlYXRlUHJvamVjdENsYXNzLCBjcmVhdGVUYXNrQ2xhc3MsIHNldExvY2FsU3RvcmFnZSwgYXJyUHJvamVjdHN9IiwiaW1wb3J0IHsgY3JlYXRlUHJvamVjdENsYXNzLCBjcmVhdGVUYXNrQ2xhc3MsIHNldExvY2FsU3RvcmFnZSwgYXJyUHJvamVjdHMgfSBmcm9tIFwiLi9sb2dpYy5qc1wiO1xubGV0IGVkaXQgPSBmYWxzZTtcbmxldCBwcm9qZWN0SGVhZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtaGVhZGVyJyk7XG5jb25zdCB0YXNrRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWZvcm0nKTtcbmNvbnN0IHByb2plY3RNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LW1vZGFsJyk7XG5jb25zdCB0YXNrTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1tb2RhbCcpO1xuXG5mdW5jdGlvbiBjcmVhdGVQcm9qZWN0KHByb2plY3ROYW1lKSB7XG4gIGNsZWFyVGFzaygpO1xuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgY29uc3QgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3QgZGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuXG4gIHByb2plY3RIZWFkZXIuaW5uZXJUZXh0ID0gcHJvamVjdE5hbWU7XG4gIGRpdi5jbGFzc0xpc3QuYWRkKCdwcm9qZWN0Jyk7XG4gIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdC1pbmRleCcsIGFyclByb2plY3RzLmxlbmd0aCk7XG4gIHAuY2xhc3NMaXN0LmFkZCgnbW91c2UtZWZmZWN0Jyk7XG4gIHAuaW5uZXJUZXh0ID0gcHJvamVjdE5hbWU7XG4gIGRlbGV0ZUJ0bi5jbGFzc0xpc3QuYWRkKCdpY29uJywgJ2RlbGV0ZS1pY29uJyk7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtcHJvamVjdC1idG4nKS5kaXNhYmxlZCA9IGZhbHNlO1xuXG4gIHAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgcHJvamVjdEhlYWRlci5pbm5lclRleHQgPSBwcm9qZWN0TmFtZTtcbiAgICBsZXQgcHJvamVjdEluZGV4ID0gZGl2LmRhdGFzZXQucHJvamVjdEluZGV4O1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWZvcm0nKS5kYXRhc2V0LnByb2plY3RJbmRleCA9IHByb2plY3RJbmRleDtcbiAgICBjbGVhclRhc2soKTtcbiAgICBmb3IobGV0IHRhc2sgb2YgcHJvamVjdC50YXNrcykge1xuICAgICAgYXBwZW5kVGFzayhwcm9qZWN0SW5kZXgsIGFyclByb2plY3RzW3Byb2plY3RJbmRleF0udGFza3MuaW5kZXhPZih0YXNrKSk7XG4gICAgfVxuICB9KTtcblxuICBkZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgbGV0IHByb2plY3RJbmRleCA9IGRpdi5kYXRhc2V0LnByb2plY3RJbmRleDtcbiAgICBkZWxldGVQcm9qZWN0KGRpdiwgcHJvamVjdCk7XG4gICAgaWYocHJvamVjdEluZGV4ID4gMCkge1xuICAgICAgZm9yKGxldCB0YXNrIG9mIGFyclByb2plY3RzW3Byb2plY3RJbmRleCAtIDFdLnRhc2tzKSB7XG4gICAgICAgIGFwcGVuZFRhc2sodGFzay50aXRsZSwgdGFzay5kZXNjLCB0YXNrLmR1ZWRhdGUsIHRhc2sucHJpb3JpdHksIHRhc2suY29tcGxldGUsIHByb2plY3RJbmRleCAtIDEsIHByb2plY3ROYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gICAgc2V0TG9jYWxTdG9yYWdlKCk7XG4gIH0pO1xuXG4gIHdoaWxlKGRpdi5oYXNDaGlsZE5vZGVzKCkpIHtcbiAgICBkaXYucmVtb3ZlQ2hpbGQoZGl2Lmxhc3RDaGlsZCk7XG4gIH1cblxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1jb250YWluZXInKS5hcHBlbmRDaGlsZChwcm9qZWN0SGVhZGVyKTtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3RzLWNvbnRhaW5lcicpLmFwcGVuZENoaWxkKGRpdik7XG4gIGRpdi5hcHBlbmQocCwgZGVsZXRlQnRuKTtcblxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1mb3JtJykuZGF0YXNldC5wcm9qZWN0SW5kZXggPSBkaXYuZGF0YXNldC5wcm9qZWN0SW5kZXg7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LWZvcm0nKS5yZXNldCgpO1xuICBwcm9qZWN0TW9kYWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gIGNvbnN0IHByb2plY3QgPSBjcmVhdGVQcm9qZWN0Q2xhc3MocC5pbm5lclRleHQsIFtdKTtcbiAgc2V0TG9jYWxTdG9yYWdlKCk7XG59XG5cbmZ1bmN0aW9uIGFwcGVuZFByb2plY3QocHJvamVjdCkge1xuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgY29uc3QgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3QgZGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuXG4gIGRpdi5jbGFzc0xpc3QuYWRkKCdwcm9qZWN0Jyk7XG4gIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdC1pbmRleCcsIGFyclByb2plY3RzLmluZGV4T2YocHJvamVjdCkpO1xuICBwLmNsYXNzTGlzdC5hZGQoJ21vdXNlLWVmZmVjdCcpO1xuICBwLmlubmVyVGV4dCA9IHByb2plY3QudGl0bGU7XG4gIGRlbGV0ZUJ0bi5jbGFzc0xpc3QuYWRkKCdpY29uJywgJ2RlbGV0ZS1pY29uJyk7XG5cbiAgcC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBwcm9qZWN0SGVhZGVyLmlubmVyVGV4dCA9IHByb2plY3QudGl0bGU7XG4gICAgbGV0IHByb2plY3RJbmRleCA9IGFyclByb2plY3RzLmluZGV4T2YocHJvamVjdCk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stZm9ybScpLmRhdGFzZXQucHJvamVjdEluZGV4ID0gcHJvamVjdEluZGV4O1xuICAgIGNsZWFyVGFzaygpO1xuICAgIGZvcihsZXQgdGFzayBvZiBwcm9qZWN0LnRhc2tzKSB7XG4gICAgICBhcHBlbmRUYXNrKHByb2plY3RJbmRleCwgYXJyUHJvamVjdHNbcHJvamVjdEluZGV4XS50YXNrcy5pbmRleE9mKHRhc2spKTtcbiAgICB9XG4gIH0pO1xuXG4gIGRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBsZXQgcHJvamVjdEluZGV4ID0gYXJyUHJvamVjdHMuaW5kZXhPZihwcm9qZWN0KTtcbiAgICBkZWxldGVQcm9qZWN0KGRpdiwgcHJvamVjdCk7XG4gICAgaWYocHJvamVjdEluZGV4ID4gMCkge1xuICAgICAgZm9yKGxldCB0YXNrIG9mIGFyclByb2plY3RzW3Byb2plY3RJbmRleCAtIDFdLnRhc2tzKSB7XG4gICAgICAgIGFwcGVuZFRhc2sodGFzay50aXRsZSwgdGFzay5kZXNjLCB0YXNrLmR1ZWRhdGUsIHRhc2sucHJpb3JpdHksIHRhc2suY29tcGxldGUsIHByb2plY3RJbmRleCAtIDEsIHByb2plY3QudGl0bGUpO1xuICAgICAgfVxuICAgIH1cbiAgICBzZXRMb2NhbFN0b3JhZ2UoKTtcbiAgfSk7XG5cbiAgd2hpbGUoZGl2Lmhhc0NoaWxkTm9kZXMoKSkge1xuICAgIGRpdi5yZW1vdmVDaGlsZChkaXYubGFzdENoaWxkKTtcbiAgfVxuXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0cy1jb250YWluZXInKS5hcHBlbmRDaGlsZChkaXYpO1xuICBkaXYuYXBwZW5kKHAsIGRlbGV0ZUJ0bik7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZVByb2plY3QoZGl2LCBwcm9qZWN0KSB7XG4gIGxldCBpbmRleCA9IGRpdi5kYXRhc2V0LnByb2plY3RJbmRleDtcbiAgZGl2LnJlbW92ZSgpO1xuICBwcm9qZWN0LnJlbW92ZVByb2plY3QoKTtcbiAgaWYoaW5kZXggPiAwKSB7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stZm9ybScpLmRhdGFzZXQucHJvamVjdEluZGV4ID0gaW5kZXggLSAxO1xuICAgIHByb2plY3RIZWFkZXIuaW5uZXJUZXh0ID0gYXJyUHJvamVjdHNbaW5kZXggLSAxXS50aXRsZTtcbiAgfSBlbHNlIHtcbiAgICBwcm9qZWN0SGVhZGVyLmlubmVyVGV4dCA9IFwiXCI7XG4gIH1cbiAgY29uc3QgcHJvamVjdFRhc2tzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgZGl2LnRhc2tbZGF0YS1wcm9qZWN0LWluZGV4PVwiJHtpbmRleH1cIl1gKTtcbiAgZm9yKGxldCB0YXNrIG9mIHByb2plY3RUYXNrcykge1xuICAgIHRhc2sucmVtb3ZlKCk7XG4gIH1cbiAgY29uc3QgcHJvamVjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucHJvamVjdCcpO1xuICBmb3IobGV0IGkgaW4gYXJyUHJvamVjdHMpIHtcbiAgICBwcm9qZWN0c1tpXS5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdC1pbmRleCcsIGkpO1xuICB9XG4gIHNldExvY2FsU3RvcmFnZSgpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVUYXNrKHByb2plY3RJbmRleCkge1xuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgY29uc3QgZXhwYW5kQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBjb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIGNvbnN0IGNoZWNrYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgY29uc3QgcFRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBjb25zdCBwRGVzYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3QgcER1ZURhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbnN0IHBQcmlvcml0eSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3QgZWRpdEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgY29uc3QgZGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuXG4gIGxldCB0YXNrSW5kZXggPSBhcnJQcm9qZWN0c1twcm9qZWN0SW5kZXhdLnRhc2tzLmxlbmd0aDtcbiAgbGV0IHRpdGxlVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay10aXRsZScpLnZhbHVlO1xuICBsZXQgZGVzY1ZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stZGVzYycpLnZhbHVlO1xuICBsZXQgZHVlRGF0ZVZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stZHVlLWRhdGUnKS52YWx1ZTtcbiAgbGV0IHByaW9yaXR5VmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1wcmlvcml0eScpLnZhbHVlO1xuXG4gIGRpdi5jbGFzc0xpc3QuYWRkKCd0YXNrJyk7XG4gIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdC1pbmRleCcsIHByb2plY3RJbmRleCk7XG4gIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGFzay1pbmRleCcsIHRhc2tJbmRleCk7XG4gIGV4cGFuZEJ0bi5jbGFzc0xpc3QuYWRkKCdleHBhbmQnKTtcbiAgbGFiZWwuaW5uZXJUZXh0ID0gXCJVbmZpbmlzaGVkXCI7XG4gIGxhYmVsLmNsYXNzTGlzdC5hZGQoJ2NoZWNrYm94Jyk7XG4gIGNoZWNrYm94LnR5cGUgPSBcImNoZWNrYm94XCI7XG4gIGNoZWNrYm94LmNsYXNzTGlzdC5hZGQoJ2NoZWNrYm94Jyk7XG4gIHBUaXRsZS5pbm5lclRleHQgPSB0aXRsZVZhbHVlO1xuICBwRGVzYy5jbGFzc0xpc3QuYWRkKCdkZXNjJyk7XG4gIHBEZXNjLmlubmVyVGV4dCA9IGRlc2NWYWx1ZTtcbiAgcER1ZURhdGUuaW5uZXJUZXh0ID0gZHVlRGF0ZVZhbHVlO1xuICBwUHJpb3JpdHkuaW5uZXJUZXh0ID0gcHJpb3JpdHlWYWx1ZTtcbiAgbGV0IGNvbG9yID0gc2V0UHJpb3JpdHlDb2xvcihOdW1iZXIocHJpb3JpdHlWYWx1ZSkpO1xuICBwUHJpb3JpdHkuc3R5bGUuY29sb3IgPSBjb2xvcjtcbiAgZWRpdEJ0bi5jbGFzc0xpc3QuYWRkKCdpY29uJywgJ2VkaXQtaWNvbicpO1xuICBkZWxldGVCdG4uY2xhc3NMaXN0LmFkZCgnaWNvbicsICdkZWxldGUtaWNvbicpO1xuXG4gIGV4cGFuZEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBpZihleHBhbmRCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdyb3RhdGUtdXAnKSkge1xuICAgICAgZXhwYW5kQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ3JvdGF0ZS11cCcpO1xuICAgICAgZXhwYW5kQnRuLmNsYXNzTGlzdC5hZGQoJ3JvdGF0ZS1kb3duJyk7XG5cbiAgICAgIGRpdi5jbGFzc0xpc3QuYWRkKCd0YXNrLWV4cGFuZCcpO1xuICAgICAgZGl2LmNsYXNzTGlzdC5yZW1vdmUoJ3Rhc2stcmVkdWNlJyk7XG5cbiAgICAgIHBEZXNjLmNsYXNzTGlzdC5hZGQoJ2Rlc2MtZXhwYW5kJyk7XG4gICAgfSBlbHNlIGlmIChleHBhbmRCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdyb3RhdGUtZG93bicpKSB7XG4gICAgICBleHBhbmRCdG4uY2xhc3NMaXN0LnJlbW92ZSgncm90YXRlLWRvd24nKTtcbiAgICAgIGV4cGFuZEJ0bi5jbGFzc0xpc3QuYWRkKCdyb3RhdGUtdXAnKTtcblxuICAgICAgZGl2LmNsYXNzTGlzdC5yZW1vdmUoJ3Rhc2stZXhwYW5kJyk7XG4gICAgICBkaXYuY2xhc3NMaXN0LmFkZCgndGFzay1yZWR1Y2UnKTtcblxuICAgICAgcERlc2MuY2xhc3NMaXN0LnJlbW92ZSgnZGVzYy1leHBhbmQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZXhwYW5kQnRuLmNsYXNzTGlzdC5hZGQoJ3JvdGF0ZS1kb3duJyk7XG4gICAgICBkaXYuY2xhc3NMaXN0LmFkZCgndGFzay1leHBhbmQnKTtcbiAgICAgIHBEZXNjLmNsYXNzTGlzdC5hZGQoJ2Rlc2MtZXhwYW5kJyk7XG4gICAgfVxuICB9KTtcblxuICBjaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBpZih0YXNrLmNvbXBsZXRlID09PSBmYWxzZSkge1xuICAgICAgdGFzay5jb21wbGV0ZSA9IHRydWU7XG4gICAgICBsYWJlbC5pbm5lclRleHQgPSBcIkNvbXBsZXRlXCI7XG4gICAgICBkaXYuY2xhc3NMaXN0LmFkZCgnY29tcGxldGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGFzay5jb21wbGV0ZSA9IGZhbHNlO1xuICAgICAgbGFiZWwuaW5uZXJUZXh0ID0gXCJVbmZpbmlzaGVkXCI7XG4gICAgICBkaXYuY2xhc3NMaXN0LnJlbW92ZSgnY29tcGxldGUnKTtcbiAgICB9XG4gICAgc2V0TG9jYWxTdG9yYWdlKCk7XG4gIH0pO1xuXG4gIGVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgZWRpdCA9IHRydWU7XG4gICAgdGFza01vZGFsLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgdGFza0Zvcm0uZGF0YXNldC50YXNrSW5kZXggPSBhcnJQcm9qZWN0c1twcm9qZWN0SW5kZXhdLnRhc2tzLmluZGV4T2YodGFzayk7XG4gICAgZmlsbEVkaXRGb3JtKHBUaXRsZS5pbm5lclRleHQsIHBEZXNjLmlubmVyVGV4dCwgcER1ZURhdGUuaW5uZXJUZXh0LCBwUHJpb3JpdHkuaW5uZXJUZXh0KTtcbiAgfSk7XG5cbiAgZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGRlbGV0ZVRhc2soZGl2LCB0YXNrKTtcbiAgfSk7XG5cbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stY29udGFpbmVyJykuYXBwZW5kQ2hpbGQoZGl2KTtcbiAgZGl2LmFwcGVuZChleHBhbmRCdG4sIGNoZWNrYm94LCBsYWJlbCwgcFRpdGxlLCBwRGVzYywgcER1ZURhdGUsIHBQcmlvcml0eSwgZWRpdEJ0biwgZGVsZXRlQnRuKTtcblxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1mb3JtJykucmVzZXQoKTtcbiAgdGFza01vZGFsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICBjb25zdCB0YXNrID0gY3JlYXRlVGFza0NsYXNzKHRpdGxlVmFsdWUsIGRlc2NWYWx1ZSwgZHVlRGF0ZVZhbHVlLCBwcmlvcml0eVZhbHVlLCBmYWxzZSwgcHJvamVjdEluZGV4KTtcbiAgc2V0TG9jYWxTdG9yYWdlKCk7XG59XG5cbmZ1bmN0aW9uIHNldFByaW9yaXR5Q29sb3IobnVtKSB7XG4gIHN3aXRjaCAobnVtKSB7XG4gICAgY2FzZSAxOlxuICAgICAgcmV0dXJuIFwicmVkXCI7O1xuICAgIGNhc2UgMjpcbiAgICAgIHJldHVybiBcIm9yYW5nZVwiO1xuICAgIGNhc2UgMzpcbiAgICAgIHJldHVybiBcImdyZWVuXCI7XG4gICAgY2FzZSA0OlxuICAgICAgcmV0dXJuIFwiYmx1ZVwiO1xuIH1cbn1cblxuZnVuY3Rpb24gYXBwZW5kVGFzayhwcm9qZWN0SW5kZXgsIHRhc2tJbmRleCkge1xuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgY29uc3QgZXhwYW5kQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBjb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIGNvbnN0IGNoZWNrYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgY29uc3QgcFRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBjb25zdCBwRGVzYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3QgcER1ZURhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbnN0IHBQcmlvcml0eSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3QgZWRpdEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgY29uc3QgZGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBsZXQgdGFzayA9IGFyclByb2plY3RzW3Byb2plY3RJbmRleF0udGFza3NbdGFza0luZGV4XTtcblxuICBkaXYuY2xhc3NMaXN0LmFkZCgndGFzaycpO1xuICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLXByb2plY3QtaW5kZXgnLCBwcm9qZWN0SW5kZXgpO1xuICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLXRhc2staW5kZXgnLCB0YXNrSW5kZXgpO1xuICBjaGVja2JveC50eXBlID0gXCJjaGVja2JveFwiO1xuICBjaGVja2JveC5jbGFzc0xpc3QuYWRkKCdjaGVja2JveCcpO1xuICBpZih0YXNrLmNvbXBsZXRlID09PSB0cnVlKSB7XG4gICAgbGFiZWwuaW5uZXJUZXh0ID0gXCJDb21wbGV0ZVwiO1xuICAgIGNoZWNrYm94LmNoZWNrZWQgPSB0cnVlO1xuICB9IGVsc2Uge1xuICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiVW5maW5pc2hlZFwiO1xuICB9XG4gIGxhYmVsLmNsYXNzTGlzdC5hZGQoJ2NoZWNrYm94Jyk7XG4gIGV4cGFuZEJ0bi5jbGFzc0xpc3QuYWRkKCdleHBhbmQnKTtcbiAgY2hlY2tib3gudHlwZSA9IFwiY2hlY2tib3hcIjtcbiAgY2hlY2tib3guY2xhc3NMaXN0LmFkZCgnY2hlY2tib3gnKTtcbiAgaWYodGFzay5jb21wbGV0ZSA9PT0gdHJ1ZSkge1xuICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiQ29tcGxldGVcIjtcbiAgICBkaXYuY2xhc3NMaXN0LmFkZCgnY29tcGxldGUnKTtcbiAgfSBlbHNlIHtcbiAgICBsYWJlbC5pbm5lclRleHQgPSBcIlVuZmluaXNoZWRcIjtcbiAgICBkaXYuY2xhc3NMaXN0LnJlbW92ZSgnY29tcGxldGUnKTtcbiAgfVxuICBwVGl0bGUuaW5uZXJUZXh0ID0gdGFzay50aXRsZTtcbiAgcERlc2MuY2xhc3NMaXN0LmFkZCgnZGVzYycpO1xuICBwRGVzYy5pbm5lclRleHQgPSB0YXNrLmRlc2M7XG4gIHBEdWVEYXRlLmlubmVyVGV4dCA9IHRhc2suZHVlZGF0ZTtcbiAgbGV0IGNvbG9yID0gc2V0UHJpb3JpdHlDb2xvcihOdW1iZXIodGFzay5wcmlvcml0eSkpO1xuICBwUHJpb3JpdHkuc3R5bGUuY29sb3IgPSBjb2xvcjtcbiAgcFByaW9yaXR5LmlubmVyVGV4dCA9IHRhc2sucHJpb3JpdHk7XG4gIGVkaXRCdG4uY2xhc3NMaXN0LmFkZCgnaWNvbicsICdlZGl0LWljb24nKTtcbiAgZGVsZXRlQnRuLmNsYXNzTGlzdC5hZGQoJ2ljb24nLCAnZGVsZXRlLWljb24nKTtcblxuICBleHBhbmRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgaWYoZXhwYW5kQnRuLmNsYXNzTGlzdC5jb250YWlucygncm90YXRlLXVwJykpIHtcbiAgICAgIGV4cGFuZEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdyb3RhdGUtdXAnKTtcbiAgICAgIGV4cGFuZEJ0bi5jbGFzc0xpc3QuYWRkKCdyb3RhdGUtZG93bicpO1xuXG4gICAgICBkaXYuY2xhc3NMaXN0LmFkZCgndGFzay1leHBhbmQnKTtcbiAgICAgIGRpdi5jbGFzc0xpc3QucmVtb3ZlKCd0YXNrLXJlZHVjZScpO1xuXG4gICAgICBwRGVzYy5jbGFzc0xpc3QuYWRkKCdkZXNjLWV4cGFuZCcpO1xuICAgIH0gZWxzZSBpZiAoZXhwYW5kQnRuLmNsYXNzTGlzdC5jb250YWlucygncm90YXRlLWRvd24nKSkge1xuICAgICAgZXhwYW5kQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ3JvdGF0ZS1kb3duJyk7XG4gICAgICBleHBhbmRCdG4uY2xhc3NMaXN0LmFkZCgncm90YXRlLXVwJyk7XG5cbiAgICAgIGRpdi5jbGFzc0xpc3QucmVtb3ZlKCd0YXNrLWV4cGFuZCcpO1xuICAgICAgZGl2LmNsYXNzTGlzdC5hZGQoJ3Rhc2stcmVkdWNlJyk7XG5cbiAgICAgIHBEZXNjLmNsYXNzTGlzdC5yZW1vdmUoJ2Rlc2MtZXhwYW5kJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGV4cGFuZEJ0bi5jbGFzc0xpc3QuYWRkKCdyb3RhdGUtZG93bicpO1xuICAgICAgZGl2LmNsYXNzTGlzdC5hZGQoJ3Rhc2stZXhwYW5kJyk7XG4gICAgICBwRGVzYy5jbGFzc0xpc3QuYWRkKCdkZXNjLWV4cGFuZCcpO1xuICAgIH1cblxuICB9KTtcblxuICBjaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBpZih0YXNrLmNvbXBsZXRlID09PSBmYWxzZSkge1xuICAgICAgdGFzay5jb21wbGV0ZSA9IHRydWU7XG4gICAgICBsYWJlbC5pbm5lclRleHQgPSBcIkNvbXBsZXRlXCI7XG4gICAgICBkaXYuY2xhc3NMaXN0LmFkZCgnY29tcGxldGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGFzay5jb21wbGV0ZSA9IGZhbHNlO1xuICAgICAgbGFiZWwuaW5uZXJUZXh0ID0gXCJVbmZpbmlzaGVkXCI7XG4gICAgICBkaXYuY2xhc3NMaXN0LnJlbW92ZSgnY29tcGxldGUnKTtcbiAgICB9XG4gICAgc2V0TG9jYWxTdG9yYWdlKCk7XG4gIH0pO1xuXG4gIGVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgZWRpdCA9IHRydWU7XG4gICAgdGFza01vZGFsLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgdGFza0Zvcm0uZGF0YXNldC50YXNrSW5kZXggPSB0YXNrSW5kZXg7XG4gICAgZmlsbEVkaXRGb3JtKHBUaXRsZS5pbm5lclRleHQsIHBEZXNjLmlubmVyVGV4dCwgcER1ZURhdGUuaW5uZXJUZXh0LCBwUHJpb3JpdHkuaW5uZXJUZXh0KTtcbiAgfSk7XG5cbiAgZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGRlbGV0ZVRhc2soZGl2LCB0YXNrKTtcbiAgfSlcblxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1jb250YWluZXInKS5hcHBlbmRDaGlsZChkaXYpO1xuICBkaXYuYXBwZW5kKGV4cGFuZEJ0biwgY2hlY2tib3gsIGxhYmVsLCBwVGl0bGUsIHBEZXNjLCBwRHVlRGF0ZSwgcFByaW9yaXR5LCBlZGl0QnRuLCBkZWxldGVCdG4pO1xufVxuXG5mdW5jdGlvbiBjbGVhclRhc2soKSB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWNvbnRhaW5lcicpO1xuICB3aGlsZShjb250YWluZXIuaGFzQ2hpbGROb2RlcygpICYmIGNvbnRhaW5lci5jaGlsZEVsZW1lbnRDb3VudCA+IDEpIHtcbiAgICBjb250YWluZXIucmVtb3ZlQ2hpbGQoY29udGFpbmVyLmxhc3RDaGlsZCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZmlsbEVkaXRGb3JtKHRpdGxlLCBkZXNjLCBkdWVkYXRlLCBwcmlvcml0eSkge1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay10aXRsZScpLnZhbHVlID0gdGl0bGU7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWRlc2MnKS52YWx1ZSA9IGRlc2M7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWR1ZS1kYXRlJykudmFsdWUgPSBkdWVkYXRlO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1wcmlvcml0eScpLnZhbHVlID0gcHJpb3JpdHk7XG59XG5cbmZ1bmN0aW9uIGVkaXRUYXNrKHByb2plY3RJbmRleCwgdGFza0luZGV4LCAuLi5mb3JtVmFsdWVzKSB7XG4gIGNvbnN0IGRpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYGRpdi50YXNrW2RhdGEtdGFzay1pbmRleD1cIiR7dGFza0luZGV4fVwiXWApO1xuICBjb25zdCB0YXNrID0gYXJyUHJvamVjdHNbcHJvamVjdEluZGV4XS50YXNrc1t0YXNrSW5kZXhdO1xuICBjb25zdCBub2RlID0gZGl2LmNoaWxkTm9kZXM7XG4gIGxldCBjb2xvciA9IHNldFByaW9yaXR5Q29sb3IoTnVtYmVyKGZvcm1WYWx1ZXNbM10pKTtcbiAgbm9kZVs2XS5zdHlsZS5jb2xvciA9IGNvbG9yO1xuICBub2RlWzNdLmlubmVyVGV4dCA9IGZvcm1WYWx1ZXNbMF07XG4gIG5vZGVbNF0uaW5uZXJUZXh0ID0gZm9ybVZhbHVlc1sxXTtcbiAgbm9kZVs1XS5pbm5lclRleHQgPSBmb3JtVmFsdWVzWzJdO1xuICBub2RlWzZdLmlubmVyVGV4dCA9IGZvcm1WYWx1ZXNbM107XG4gIHRhc2sudGl0bGUgPSBmb3JtVmFsdWVzWzBdO1xuICB0YXNrLmRlc2MgPSBmb3JtVmFsdWVzWzFdO1xuICB0YXNrLmR1ZWRhdGUgPSBmb3JtVmFsdWVzWzJdO1xuICB0YXNrLnByaW9yaXR5ID0gZm9ybVZhbHVlc1szXTtcbiAgdGFza0Zvcm0ucmVzZXQoKTtcbiAgdGFza01vZGFsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgZWRpdCA9IGZhbHNlO1xuICBzZXRMb2NhbFN0b3JhZ2UoKTtcbn1cblxuZnVuY3Rpb24gZGVsZXRlVGFzayhkaXYsIHRhc2spIHtcbiAgbGV0IGluZGV4ID0gZGl2LmRhdGFzZXQucHJvamVjdEluZGV4O1xuICBkaXYucmVtb3ZlKCk7XG4gIGFyclByb2plY3RzW2luZGV4XS5yZW1vdmVUYXNrKHRhc2spO1xuICBjb25zdCB0YXNrcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50YXNrJyk7XG4gIGZvcihsZXQgaSBpbiBhcnJQcm9qZWN0c1tpbmRleF0udGFza3MpIHtcbiAgICB0YXNrc1tpXS5kYXRhc2V0LnRhc2tJbmRleCA9IGk7XG4gIH1cbiAgc2V0TG9jYWxTdG9yYWdlKCk7XG59XG5zZXRUaW1lb3V0KCgpID0+IHtcbiAgaWYobG9jYWxTdG9yYWdlLmxlbmd0aCA9PT0gMCkge1xuICAgIGNyZWF0ZVByb2plY3QoXCJEZWZhdWx0XCIpO1xuICB9XG59LCAyMDApO1xuXG5leHBvcnQgeyBjcmVhdGVQcm9qZWN0LCBjcmVhdGVUYXNrLCBlZGl0VGFzaywgYXBwZW5kUHJvamVjdCwgYXBwZW5kVGFzaywgZWRpdCB9IiwiaW1wb3J0IHsgY3JlYXRlUHJvamVjdCwgY3JlYXRlVGFzaywgZWRpdFRhc2ssIGVkaXQgfSBmcm9tIFwiLi9ET01cIjtcblxuY29uc3QgcHJvamVjdEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtcHJvamVjdC1idG4nKTtcbmNvbnN0IGFkZFRhc2tCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXRhc2stYnRuJyk7XG5jb25zdCBwcm9qZWN0Rm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LWZvcm0nKTtcbmNvbnN0IHRhc2tGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stZm9ybScpO1xuY29uc3QgcHJvamVjdE1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtbW9kYWwnKTtcbmNvbnN0IHRhc2tNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLW1vZGFsJyk7XG5jb25zdCBjbG9zZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jbG9zZS1idG4nKTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgaWYgKGUudGFyZ2V0ID09IHByb2plY3RNb2RhbCkge1xuICAgIHByb2plY3RNb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgcHJvamVjdEZvcm0ucmVzZXQoKTtcbiAgfSBlbHNlIGlmKGUudGFyZ2V0ID09IHRhc2tNb2RhbCkge1xuICAgIHRhc2tNb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgdGFza0Zvcm0ucmVzZXQoKTtcbiAgfVxufSk7XG5cbmNsb3NlQnRuWzBdLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICBwcm9qZWN0TW9kYWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICBwcm9qZWN0Rm9ybS5yZXNldCgpO1xufSk7XG5cbmNsb3NlQnRuWzFdLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICB0YXNrTW9kYWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICB0YXNrRm9ybS5yZXNldCgpO1xufSk7XG5cbnByb2plY3RGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIChlKSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgY3JlYXRlUHJvamVjdChlLnRhcmdldFswXS52YWx1ZSk7XG59KTtcblxucHJvamVjdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgcHJvamVjdE1vZGFsLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LW5hbWUnKS5mb2N1cygpO1xufSk7XG5cbnRhc2tGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIChlKSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgaWYoZWRpdCA9PT0gZmFsc2UpIHtcbiAgICBjcmVhdGVUYXNrKGUudGFyZ2V0LmRhdGFzZXQucHJvamVjdEluZGV4KTtcbiAgfSBlbHNlIGlmKGVkaXQgPT09IHRydWUpIHtcbiAgICBlZGl0VGFzayhlLnRhcmdldC5kYXRhc2V0LnByb2plY3RJbmRleCwgZS50YXJnZXQuZGF0YXNldC50YXNrSW5kZXgsIGUudGFyZ2V0WzBdLnZhbHVlLCBlLnRhcmdldFsxXS52YWx1ZSxcbiAgICAgIGUudGFyZ2V0WzJdLnZhbHVlLCBlLnRhcmdldFszXS52YWx1ZSk7XG4gIH1cbn0pO1xuXG5hZGRUYXNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICBjb25zdCBwcm9qZWN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucHJvamVjdFwiKTtcbiAgaWYocHJvamVjdHMubGVuZ3RoID4gMCkge1xuICAgIHRhc2tNb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLXRpdGxlJykuZm9jdXMoKTtcbiAgfVxufSk7Il0sIm5hbWVzIjpbImFyclByb2plY3RzIiwiUHJvamVjdCIsImNvbnN0cnVjdG9yIiwidGl0bGUiLCJ0YXNrcyIsInRoaXMiLCJyZW1vdmVQcm9qZWN0Iiwic3BsaWNlIiwiaW5kZXhPZiIsImFkZFRhc2siLCJ0YXNrIiwicHVzaCIsInJlbW92ZVRhc2siLCJUYXNrIiwiZGVzYyIsImR1ZWRhdGUiLCJwcmlvcml0eSIsImNvbXBsZXRlIiwic2V0TG9jYWxTdG9yYWdlIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJsZW5ndGgiLCJzdG9yYWdlVmFsdWUiLCJwYXJzZSIsImdldEl0ZW0iLCJvYmoiLCJwcm9qZWN0IiwiYXBwZW5kUHJvamVjdCIsImZpcnN0UHJvamVjdCIsInVuZGVmaW5lZCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lclRleHQiLCJkYXRhc2V0IiwicHJvamVjdEluZGV4IiwiYXBwZW5kVGFzayIsImdldExvY2FsU3RvcmFnZSIsImVkaXQiLCJwcm9qZWN0SGVhZGVyIiwidGFza0Zvcm0iLCJwcm9qZWN0TW9kYWwiLCJ0YXNrTW9kYWwiLCJjcmVhdGVQcm9qZWN0IiwicHJvamVjdE5hbWUiLCJjbGVhclRhc2siLCJkaXYiLCJjcmVhdGVFbGVtZW50IiwicCIsImRlbGV0ZUJ0biIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsImRpc2FibGVkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImRlbGV0ZVByb2plY3QiLCJoYXNDaGlsZE5vZGVzIiwicmVtb3ZlQ2hpbGQiLCJsYXN0Q2hpbGQiLCJhcHBlbmRDaGlsZCIsImFwcGVuZCIsInJlc2V0Iiwic3R5bGUiLCJkaXNwbGF5IiwiY3JlYXRlUHJvamVjdENsYXNzIiwiaW5kZXgiLCJyZW1vdmUiLCJwcm9qZWN0VGFza3MiLCJxdWVyeVNlbGVjdG9yQWxsIiwicHJvamVjdHMiLCJpIiwic2V0UHJpb3JpdHlDb2xvciIsIm51bSIsInRhc2tJbmRleCIsImV4cGFuZEJ0biIsImxhYmVsIiwiY2hlY2tib3giLCJwVGl0bGUiLCJwRGVzYyIsInBEdWVEYXRlIiwicFByaW9yaXR5IiwiZWRpdEJ0biIsInR5cGUiLCJjaGVja2VkIiwiY29sb3IiLCJOdW1iZXIiLCJjb250YWlucyIsImZpbGxFZGl0Rm9ybSIsImRlbGV0ZVRhc2siLCJjb250YWluZXIiLCJjaGlsZEVsZW1lbnRDb3VudCIsInZhbHVlIiwic2V0VGltZW91dCIsInByb2plY3RCdG4iLCJhZGRUYXNrQnRuIiwicHJvamVjdEZvcm0iLCJjbG9zZUJ0biIsIndpbmRvdyIsImUiLCJ0YXJnZXQiLCJwcmV2ZW50RGVmYXVsdCIsImZvY3VzIiwidGl0bGVWYWx1ZSIsImRlc2NWYWx1ZSIsImR1ZURhdGVWYWx1ZSIsInByaW9yaXR5VmFsdWUiLCJjcmVhdGVUYXNrQ2xhc3MiLCJjcmVhdGVUYXNrIiwiZm9ybVZhbHVlcyIsInF1ZXJ5U2VsZWN0b3IiLCJub2RlIiwiY2hpbGROb2RlcyIsImVkaXRUYXNrIl0sInNvdXJjZVJvb3QiOiIifQ==